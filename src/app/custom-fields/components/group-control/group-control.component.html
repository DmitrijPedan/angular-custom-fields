<form [formGroup]="form" class="cf-form" [ngClass]="{'repeater': type === 'repeater'}" >
  <fieldset>
    <legend>
      <span>{{type | fieldName}}</span>
      <span *ngIf="fieldsFormArray.length">({{fieldsFormArray.length}} fields)</span>
    </legend>

      <app-buttons
        (removeField)="remove.emit()"
      ></app-buttons>

      <app-field-form
        [formControlName]="'conditions'"
      ></app-field-form>

      <app-buttons
        [showAdd]="type === 'repeater'"
        (addField)="addField()"
        [showArrayControls]="fieldsFormArray.length > 0"
        (closeAll)="accordion.closeAll()"
        (openAll)="accordion.openAll()"
        (clearArray)="clearFieldsArray()"
        (reorderArray)="toggleReorder()"
        [reorderDisabled]="reorderDisabled"
        style="margin-bottom: 10px"
      ></app-buttons>

      <mat-accordion
        #accordion="matAccordion"
        formArrayName="fields"
        [multi]="true"
        cdkDropList
        (cdkDropListDropped)="reorderFields($event)"
        [cdkDropListDisabled]="reorderDisabled">
        <mat-expansion-panel
          *ngFor="let control of fieldsFormArray?.controls; index as i"
          [expanded]="true"
          togglePosition="before"
          cdkDrag>
          <mat-expansion-panel-header [collapsedHeight]="'40px'" [expandedHeight]="'50px'">
            <mat-panel-title>
              <app-field-title
                [number]="i + 1"
                [value]="control.value"
                [dragDisabled]="reorderDisabled"
              ></app-field-title>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <app-group-control
            (remove)="deleteFieldFromArray(i)"
            [formControlName]="i"
            [formLabel]="'Nested Field '+ (i + 1) + ':'"
          ></app-group-control>
        </mat-expansion-panel>
      </mat-accordion>

      <app-buttons
        *ngIf="fieldsFormArray.value.length > 0"
        (addField)="addField()"
        [showArrayControls]="fieldsFormArray.length > 0"
        (closeAll)="accordion.closeAll()"
        (openAll)="accordion.openAll()"
        style="margin-top: 10px"
      ></app-buttons>

  </fieldset>
</form>


