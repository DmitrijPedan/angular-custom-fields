<form [formGroup]="form">
  <fieldset>
    <legend>
      <span>{{type | fieldName}}</span>
      <span *ngIf="fieldsFormArray.length">({{fieldsFormArray.length}} fields)</span>
    </legend>

      <app-buttons
        [showAdd]="type === 'repeater'"
        (addField)="addField()"
        (removeField)="remove.emit()"
        [showArrayControls]="fieldsFormArray.length > 0"
        (closeAll)="accordion.closeAll()"
        (openAll)="accordion.openAll()"
        (clearArray)="clearFieldsArray()"
      ></app-buttons>

      <app-field-form
        [formControlName]="'conditions'"
      ></app-field-form>

      <mat-accordion formArrayName="fields" [multi]="true" #accordion="matAccordion">
        <mat-expansion-panel *ngFor="let control of fieldsFormArray?.controls; index as i" [expanded]="true">
          <mat-expansion-panel-header [collapsedHeight]="'40px'" [expandedHeight]="'50px'">
            <mat-panel-title>
              <app-field-title [number]="i + 1" ></app-field-title>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <app-group-control
            (remove)="deleteFieldFromArray(i)"
            [formControlName]="i"
            [formLabel]="'Nested Field '+ (i + 1) + ':'"
          ></app-group-control>
        </mat-expansion-panel>
      </mat-accordion>

  </fieldset>
</form>


